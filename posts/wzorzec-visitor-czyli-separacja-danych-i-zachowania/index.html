<!DOCTYPE html>
<html lang="pl" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Wzorzec Visitor, czyli separacja danych i zachowania | Kyriet&#39;s Blog </title>

<link rel="stylesheet" href="/css/main.css?v1" id="main-stylesheet">
<link rel="prefetch" href="/css/highlight-light.css?v1" id="highlight-light-stylesheet">


<link rel="stylesheet" href="/css/dark.css?v1" id="dark-stylesheet">
<link rel="stylesheet" href="/css/highlight-dark.css?v1" id="highlight-dark-stylesheet">



</head>
<body>
  <header>
    

  <nav>
    <div id="navigation">
      <a href="/">Home</a>
      <a href="/projects/">Projekty</a>
  
  
    
      <a href="/en/posts/wzorzec-visitor-czyli-separacja-danych-i-zachowania/">In English</a>
    
  
  
  <span id="toggle-theme-button" title="Toggle light/dark theme"></span>
    </div>
    <span id="site-title">Kyriet&#39;s Blog </span>
  </nav>


  </header>
  <main>
    
  <h1>Wzorzec Visitor, czyli separacja danych i zachowania</h1>

   
  <time datetime="2025-06-11" style="display: none">2025-06-11</time>

  <p>Wzorzec visitor oddziela dane od algorytmu. Poka偶 na przykadach, kiedy warto stosowa ten wzorzec, a kiedy nie. Warto wspomnie, 偶e nie zawsze chcemy takiej separacji.</p>
<p>Za贸偶my, 偶e piszemy modu dla jakiego procesora tekstu. Mamy nastpujce 3 struktury:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Element</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Paragraph</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Link</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">List</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">items</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Nasz program ma wypisa powy偶sze struktury w formacie Markdown i HTML.</p>
<p><em>(uwaga, dla uproszczenia przykad贸w stosuj wszdzie <code>struct</code> zamiast <code>class</code>)</em></p>
<h2 id="przykad-1-jedna-klasa-kilka-algorytm贸w">Przykad 1. Jedna klasa, kilka algorytm贸w 
  <a href="#przyk%c5%82ad-1-jedna-klasa-kilka-algorytm%c3%b3w" class="anchor">
    <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M13.2218 3.32234C15.3697 1.17445 18.8521 1.17445 21 3.32234C23.1479 5.47022 23.1479 8.95263 21 11.1005L17.4645 14.636C15.3166 16.7839 11.8342 16.7839 9.6863 14.636C9.48752 14.4373 9.30713 14.2271 9.14514 14.0075C8.90318 13.6796 8.97098 13.2301 9.25914 12.9419C9.73221 12.4688 10.5662 12.6561 11.0245 13.1435C11.0494 13.1699 11.0747 13.196 11.1005 13.2218C12.4673 14.5887 14.6834 14.5887 16.0503 13.2218L19.5858 9.6863C20.9526 8.31947 20.9526 6.10339 19.5858 4.73655C18.219 3.36972 16.0029 3.36972 14.636 4.73655L13.5754 5.79721C13.1849 6.18774 12.5517 6.18774 12.1612 5.79721C11.7706 5.40669 11.7706 4.77352 12.1612 4.383L13.2218 3.32234Z"></path>
        <path d="M6.85787 9.6863C8.90184 7.64233 12.2261 7.60094 14.3494 9.42268C14.7319 9.75083 14.7008 10.3287 14.3444 10.685C13.9253 11.1041 13.2317 11.0404 12.7416 10.707C11.398 9.79292 9.48593 9.88667 8.27209 11.1005L4.73655 14.636C3.36972 16.0029 3.36972 18.219 4.73655 19.5858C6.10339 20.9526 8.31947 20.9526 9.6863 19.5858L10.747 18.5251C11.1375 18.1346 11.7706 18.1346 12.1612 18.5251C12.5517 18.9157 12.5517 19.5488 12.1612 19.9394L11.1005 21C8.95263 23.1479 5.47022 23.1479 3.32234 21C1.17445 18.8521 1.17445 15.3697 3.32234 13.2218L6.85787 9.6863Z"></path>
    </svg>
  </a>
</h2><p>Jeli jedna klasa potrzebuje kilku zachowa, to nie musimy stosowa wzorca visitor. Za贸偶my, 偶e mamy tylko klas <code>Paragraph</code>, a <code>Link</code> i <code>List</code> nie istniej. Wtedy wystarczy zwyky polimorficzny printer.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Printer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Paragraph</span><span class="o">&amp;</span> <span class="n">paragraph</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">HtmlPrinter</span> <span class="o">:</span> <span class="n">Printer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Paragraph</span><span class="o">&amp;</span> <span class="n">paragraph</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&lt;p&gt;&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">paragraph</span><span class="p">.</span><span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&lt;/p&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">MarkdownPrinter</span> <span class="o">:</span> <span class="n">Printer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Paragraph</span><span class="o">&amp;</span> <span class="n">paragraph</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">paragraph</span><span class="p">.</span><span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>U偶ycie mogoby wyglda tak:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Paragraph</span> <span class="n">paragraph</span><span class="p">{</span><span class="s">&#34;Hello, world!&#34;</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">Printer</span><span class="o">*</span> <span class="n">printer</span> <span class="o">=</span> <span class="n">getPrinter</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">printer</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="n">paragraph</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Nie wnikajmy w to jak dokadnie dziaa <code>getPrinter</code>, bo nie jest to istotne dla tego przykadu. Wa偶ne, 偶e funkcja ta podejmuje jak decyzj i zwraca abstrakcyjny printer. Mamy zatem odseparowan logik wyboru zachowania od danych i od samego wypisywania.</p>
<p>Jeli chcemy doda wsparcie dla nowego formatu, wystarczy doda now klas dziedziczc po <code>Printer</code> i zaimplementowa metod <code>print</code> dla typu <code>Paragraph</code>. Nie ma potrzeby stosowania wzorca visitor, bo mamy pen separacj danych i zachowania. Kod jest rozszerzalny i atwy do utrzymania.</p>
<p>Wystpuje tutaj tzw. &ldquo;dynamic dispatch&rdquo;, czyli po prostu polimorfizm. Wyb贸r odpowiedniej metody <code>print</code> jest podejmowany w czasie wykonywania programu.</p>
<p>Gdybymy chcieli doda wsparcie dla nowego elementu, np. <code>Link</code>, to bdzie trzeba doda now metod do klasy <code>Printer</code> i do wszystkich klas dziedziczcych. Ale wcale nie bdzie to takie proste jak si na pierwszy rzut oka wydaje. W kolejnym przykadzie zobaczymy dlaczego.</p>
<h2 id="przykad-2-wiele-klas-jeden-algorytm">Przykad 2. Wiele klas, jeden algorytm 
  <a href="#przyk%c5%82ad-2-wiele-klas-jeden-algorytm" class="anchor">
    <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M13.2218 3.32234C15.3697 1.17445 18.8521 1.17445 21 3.32234C23.1479 5.47022 23.1479 8.95263 21 11.1005L17.4645 14.636C15.3166 16.7839 11.8342 16.7839 9.6863 14.636C9.48752 14.4373 9.30713 14.2271 9.14514 14.0075C8.90318 13.6796 8.97098 13.2301 9.25914 12.9419C9.73221 12.4688 10.5662 12.6561 11.0245 13.1435C11.0494 13.1699 11.0747 13.196 11.1005 13.2218C12.4673 14.5887 14.6834 14.5887 16.0503 13.2218L19.5858 9.6863C20.9526 8.31947 20.9526 6.10339 19.5858 4.73655C18.219 3.36972 16.0029 3.36972 14.636 4.73655L13.5754 5.79721C13.1849 6.18774 12.5517 6.18774 12.1612 5.79721C11.7706 5.40669 11.7706 4.77352 12.1612 4.383L13.2218 3.32234Z"></path>
        <path d="M6.85787 9.6863C8.90184 7.64233 12.2261 7.60094 14.3494 9.42268C14.7319 9.75083 14.7008 10.3287 14.3444 10.685C13.9253 11.1041 13.2317 11.0404 12.7416 10.707C11.398 9.79292 9.48593 9.88667 8.27209 11.1005L4.73655 14.636C3.36972 16.0029 3.36972 18.219 4.73655 19.5858C6.10339 20.9526 8.31947 20.9526 9.6863 19.5858L10.747 18.5251C11.1375 18.1346 11.7706 18.1346 12.1612 18.5251C12.5517 18.9157 12.5517 19.5488 12.1612 19.9394L11.1005 21C8.95263 23.1479 5.47022 23.1479 3.32234 21C1.17445 18.8521 1.17445 15.3697 3.32234 13.2218L6.85787 9.6863Z"></path>
    </svg>
  </a>
</h2><p>Teraz mamy kilka klas, ale wszystkie z nich bd si wypisywa do Markdownu.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">MarkdownPrinter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Paragraph</span><span class="o">&amp;</span> <span class="n">paragraph</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">paragraph</span><span class="p">.</span><span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Link</span><span class="o">&amp;</span> <span class="n">link</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;[&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">link</span><span class="p">.</span><span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;](&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">link</span><span class="p">.</span><span class="n">url</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">List</span><span class="o">&amp;</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">item</span> <span class="p">:</span> <span class="n">list</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">item</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Tym razem u偶ycie wyglda tak:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">MarkdownPrinter</span> <span class="n">printer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Element</span><span class="o">*</span> <span class="n">element</span> <span class="o">=</span> <span class="n">getElement</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Au, to nie wyglda dobrze!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="n">paragraph</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Paragraph</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printer</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="n">paragraph</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="n">link</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Link</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printer</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="n">link</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="n">list</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">List</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printer</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="n">list</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Mamy tutaj tzw. &ldquo;static dispatch&rdquo;, czyli wyb贸r metody <code>print</code> jest podejmowany w czasie kompilacji. Ale jest to mo偶liwe dopiero po uzyskaniu konkretnego elementu poprzez rzutowanie dynamiczne.</p>
<p>Jeli widzimy tego typu rzutowanie, to od razu wiadomo, 偶e co jest nie tak. Widzc taki kod cz os贸b uzna, 偶e funkcja <code>print</code> powinna by metod wirtualn w klasie <code>Element</code> implementowan przez <code>Paragraph</code>, <code>Link</code> i <code>List</code>. Wtedy nie bdzie rzutowania, a polimorfizm zaatwi spraw.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">printInMarkdown</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Paragraph</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">printInMarkdown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Link</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">printInMarkdown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;[&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;](&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">url</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">List</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">items</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">printInMarkdown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">item</span> <span class="p">:</span> <span class="n">items</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">item</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Nie mamy ju偶 dedykowanego printera, a kod wyglda tak:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Element</span><span class="o">*</span> <span class="n">element</span> <span class="o">=</span> <span class="n">getElement</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">element</span><span class="o">-&gt;</span><span class="n">printInMarkdown</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>I rzeczywicie, to czsto jest wystarczajce rozwizanie, cho ma ono jedn zasadnicz wad: implementacja wypisywania do Markdown-u bdzie teraz rozrzucona po kilku klasach, zamiast by zebrana w jednym miejscu.</p>
<p>Co wicej zachowanie, kt贸re dodalimy do klasy <code>Element</code> wcale nie musi tam pasowa. Proste kontenery na dane stay si nagle odpowiedzialne za wypisywanie siebie.</p>
<p>Z pomoc przychodzi wzorzec visitor, kt贸ry pozwoli nam na odseparowanie danych od zachowania.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">MarkdownPrinter</span><span class="o">*</span> <span class="n">printer</span><span class="p">)</span> <span class="k">override</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Paragraph</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">MarkdownPrinter</span><span class="o">*</span> <span class="n">printer</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printer</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Link</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">MarkdownPrinter</span><span class="o">*</span> <span class="n">printer</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printer</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">List</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">items</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">MarkdownPrinter</span><span class="o">*</span> <span class="n">printer</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printer</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>I teraz jest cakiem nie藕le, bo mamy pen separacj danych i zachowania. Dokadnie do tego su偶y visitor.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Element</span><span class="o">*</span> <span class="n">element</span> <span class="o">=</span> <span class="n">getElement</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">MarkdownPrinter</span> <span class="n">printer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">element</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">printer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Uzyskalimy tutaj tzw. &ldquo;double dispatch&rdquo;, czyli wyb贸r metody <code>Element::print</code> jest dynamiczny (polimorfizm), a wyb贸r metody <code>MarkdownPrinter::print</code> jest statyczny (przeci偶enie nazwy funkcji).</p>
<p>Najpowa偶niejszy problem pojawi si, gdy poza Markdown-em zechcemy doda wsparcie dla HTML-a. Podobnie jak w przykadzie 1, to wcale nie jest takie proste jak si mo偶e wydawa. W tym celu bdziemy musieli zmodyfikowa zar贸wno wszystkie podklasy <code>Element</code>, jak i doda now klas <code>HtmlPrinter</code> (to jest akurat zrozumiae). A jeli w og贸le nie skorzystalimy z visitora, to uzyskamy prawdopodobnie kod podobny do tego:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Element</span><span class="o">*</span> <span class="n">element</span> <span class="o">=</span> <span class="n">getElement</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Znowu wracamy do serii warunk贸w
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">shouldPrintInMarkdown</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">element</span><span class="o">-&gt;</span><span class="n">printInMarkdown</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">shouldPrintInHtml</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">element</span><span class="o">-&gt;</span><span class="n">printInHtml</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Nie rzuca si to a偶 tak w oczy jak <code>dynamic_cast</code>, ale nadal otrzymalimy kod, kt贸ry jest trudniejszy do rozszerzenia ni偶 m贸gby by. Dodanie nowego formatu wymaga dodania metody <code>printInXXX</code> i pamitania o dopisaniu kolejnego if-a w kodzie powy偶ej.</p>
<p>Oczywicie powy偶sze przykady s bardzo uproszczone, aby dao si je zrozumie bez wikszego wysiku. W du偶ym systemie problemy, kt贸re tu pokazuj maj du偶o powa偶niejsze konsekwencje.</p>
<p>Czy da si lepiej? Oczywicie! Z pomoc przychodzi abstrakcyjny visitor.</p>
<h2 id="przykad-3-wiele-klas-wiele-algorytm贸w">Przykad 3. Wiele klas, wiele algorytm贸w 
  <a href="#przyk%c5%82ad-3-wiele-klas-wiele-algorytm%c3%b3w" class="anchor">
    <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M13.2218 3.32234C15.3697 1.17445 18.8521 1.17445 21 3.32234C23.1479 5.47022 23.1479 8.95263 21 11.1005L17.4645 14.636C15.3166 16.7839 11.8342 16.7839 9.6863 14.636C9.48752 14.4373 9.30713 14.2271 9.14514 14.0075C8.90318 13.6796 8.97098 13.2301 9.25914 12.9419C9.73221 12.4688 10.5662 12.6561 11.0245 13.1435C11.0494 13.1699 11.0747 13.196 11.1005 13.2218C12.4673 14.5887 14.6834 14.5887 16.0503 13.2218L19.5858 9.6863C20.9526 8.31947 20.9526 6.10339 19.5858 4.73655C18.219 3.36972 16.0029 3.36972 14.636 4.73655L13.5754 5.79721C13.1849 6.18774 12.5517 6.18774 12.1612 5.79721C11.7706 5.40669 11.7706 4.77352 12.1612 4.383L13.2218 3.32234Z"></path>
        <path d="M6.85787 9.6863C8.90184 7.64233 12.2261 7.60094 14.3494 9.42268C14.7319 9.75083 14.7008 10.3287 14.3444 10.685C13.9253 11.1041 13.2317 11.0404 12.7416 10.707C11.398 9.79292 9.48593 9.88667 8.27209 11.1005L4.73655 14.636C3.36972 16.0029 3.36972 18.219 4.73655 19.5858C6.10339 20.9526 8.31947 20.9526 9.6863 19.5858L10.747 18.5251C11.1375 18.1346 11.7706 18.1346 12.1612 18.5251C12.5517 18.9157 12.5517 19.5488 12.1612 19.9394L11.1005 21C8.95263 23.1479 5.47022 23.1479 3.32234 21C1.17445 18.8521 1.17445 15.3697 3.32234 13.2218L6.85787 9.6863Z"></path>
    </svg>
  </a>
</h2><p>Przejd藕my od razu do kodu:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">Printer</span><span class="o">*</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Paragraph</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">Printer</span><span class="o">*</span> <span class="n">printer</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printer</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Link</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">Printer</span><span class="o">*</span> <span class="n">printer</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printer</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">List</span> <span class="o">:</span> <span class="n">Element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">items</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">Printer</span><span class="o">*</span> <span class="n">printer</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printer</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Widzimy, 偶e klasy nadal wiedz o tym, 偶e maj by wypisywane, ale logika, kt贸ra to robi jest gdzie indziej.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Printer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Paragraph</span><span class="o">&amp;</span> <span class="n">paragraph</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Link</span><span class="o">&amp;</span> <span class="n">link</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">List</span><span class="o">&amp;</span> <span class="n">list</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">HtmlPrinter</span> <span class="o">:</span> <span class="n">Printer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Paragraph</span><span class="o">&amp;</span> <span class="n">paragraph</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&lt;p&gt;&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">paragraph</span><span class="p">.</span><span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&lt;/p&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Link</span><span class="o">&amp;</span> <span class="n">link</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&lt;a href=</span><span class="se">\&#34;</span><span class="s">&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">link</span><span class="p">.</span><span class="n">url</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\&#34;</span><span class="s">&gt;&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">link</span><span class="p">.</span><span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&lt;/a&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">List</span><span class="o">&amp;</span> <span class="n">list</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&lt;ul&gt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">item</span> <span class="p">:</span> <span class="n">list</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  &lt;li&gt;&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">item</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&lt;/li&gt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&lt;/ul&gt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">MarkdownPrinter</span> <span class="o">:</span> <span class="n">Printer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Paragraph</span><span class="o">&amp;</span> <span class="n">paragraph</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">paragraph</span><span class="p">.</span><span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">Link</span><span class="o">&amp;</span> <span class="n">link</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;[&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">link</span><span class="p">.</span><span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;](&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">link</span><span class="p">.</span><span class="n">url</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">List</span><span class="o">&amp;</span> <span class="n">list</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">item</span> <span class="p">:</span> <span class="n">list</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">item</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Mamy teraz dwie implementacje <code>Printer</code>-a. Ka偶da z nich skupia si na jednym formacie.</p>
<p>Pora na u偶ycie tego kodu:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Element</span><span class="o">*</span> <span class="n">element</span> <span class="o">=</span> <span class="n">getElement</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Printer</span><span class="o">*</span> <span class="n">printer</span> <span class="o">=</span> <span class="n">getPrinter</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">element</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="n">printer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>No cudo! Myl, 偶e powy偶szy kod sam si broni. Poczylimy wiele typ贸w danych z wieloma zachowaniami zachowujc przy tym pen separacj. Jeli trzeba co poprawi w skadni HTML, to mamy jedn klas, kt贸ra zajmuje si tylko tym - wypisywaniem wszystkich element贸w do HTML-a.</p>
<p>Dodanie nowego formatu nie wymaga modyfikacji Element-贸w.</p>
<p>Dodanie nowego elementu, poza trywialn implementacj metody <code>Element::print</code>, wymaga dopisania nowej metody <code>Printer::print</code> do ka偶dego <code>Printer</code>-a. To jest akurat zrozumiae, nikt tego za nas nie zrobi. Plus jest taki, 偶e jeli zapomnimy o dopisaniu jednej z metod, to kompilacja programu si nie powiedzie. Dla por贸wnania, wczeniej moglimy zapomnie o dopisaniu kolejnego if-a i program by si uruchomi, ale dziaaby niepoprawnie.</p>
<p>Uzyskalimy poczenie zalet z obu poprzednich przykad贸w.</p>
<p>Na koniec zmapujmy nazwy klas i metod do terminologii wzorca visitor:</p>
<table>
<thead>
<tr>
<th>Klasa/Metoda</th>
<th>Terminologia wzorca visitor</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Printer</code></td>
<td><code>Visitor</code></td>
</tr>
<tr>
<td><code>Printer::print()</code></td>
<td>Metoda <code>visit</code></td>
</tr>
<tr>
<td><code>Element::print()</code></td>
<td>Metoda <code>accept</code></td>
</tr>
</tbody>
</table>
<p>Osobicie nie jestem fanem u偶ywania tej terminologii w kodzie. Dowiadczony programista i tak szybko zorientuje si, 偶e ma do czynienia z visitorem, a nazywanie funkcji i klas w spos贸b, kt贸ry jest zgodny z ich rol w kodzie jest dla mnie bardziej naturalne.</p>

  </main>
  <footer>
    <div class="footer-links">
    <p><a href="https://github.com/KyrietS">github</a></p>
    <p><a href="/projects/">projekty</a></p>
    <p><a href="/">o mnie</a></p>
    <p><a href="/contact/">kontakt</a></p>
</div>


<div class="footer-last-edited">
  <a target="_blank" href="https://github.com/KyrietS/blog/commit/e34420e00a8ae2d7cf37c40dce1f1d9c4b8eef03">Ostatnia modyfikacja: 2025-07-12</a>
</div>

  </footer>
</body>


<script src="/js/main.js"></script>

<!--Szata graficzna tego bloga zostaa "zainspirowana"  z tego bloga: https://thomashope.xyz/ -->
</html>
